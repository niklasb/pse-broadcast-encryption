\documentclass[a4paper,10pt]{scrartcl}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{booktabs}
\usepackage{import}
\usepackage{xspace}
\usepackage{enumitem}
\usepackage{cite}
\usepackage{graphicx}
\usepackage{tikz}
\usepackage{wrapfig}
\usepackage{pdflscape}
\usetikzlibrary{arrows}
\usetikzlibrary{fit}
\usetikzlibrary{calc}
\usepackage{float}
\usepackage{amssymb}
\usepackage{listings}
\usepackage[section]{placeins} % don't move figures beyond the next section heading

% this is needed for forms and links within the text
\usepackage{hyperref}

% Variables
\newcommand{\authorName}{
   Mohammed~Abu~Jayyab,
   Niklas~Baumstark,
   Tobias~Gräf,
   Amrei~Loose,
   Christoph~Michel
}
\newcommand{\authorNameEmph}{
   Mohammed~Abu~Jayyab,
   \textbf{Niklas~Baumstark},
   Tobias~Gräf,
   Amrei~Loose,
   Christoph~Michel
}

\newcommand{\dateFirstVersion}{\today}
\newcommand{\customer}{Karlsruhe Institute of Technology}
\newcommand{\contractor}{A company}
\newcommand{\projectName}{Broadcast Encryption\xspace}

\newcommand{\doctitle}{\projectName (Implementation document)}
\title{\doctitle}
\author{\authorName}
\date{\today}

\include{style}

\begin{document}

\input{frontpage}
\tableofcontents
\clearpage

\section{Introduction}
This document contains the changes applied on the implementation with respect to the design document.
Some of these changes were necessary, and then there are additional changes to improve the performance.
The elements as attributes, methods and classes were renamed, whenever it was useful. In the following the 
changes are listed and described.

\section{Changes in the packages}
\subsection{Package cryptocast.comm}

\begin{itemize}
   
	\item \textbf{\textit{class SimpleHttpStreamServer}}
	\begin{itemize}
	 \item This class was added for representing a simple tcp based http server.
	\end{itemize}
	
   \item \textbf{\textit{class MessageBuffer}}
	\begin{itemize}
	 \item This class was added for representing a buffer for all message.
	\end{itemize}
	
	 \item \textbf{\textit{class StreamUtils}}
	\begin{itemize}
	 \item This class was added to provide utility methods for input and output streams.
	\end{itemize}
	
	 \item \textbf{\textit{class ThrottledOutputStream}}
	\begin{itemize}
	 \item This class was added for representing an IntputStream proxy which limits the number of bytes read per second.
	\end{itemize}
	
	\item \textbf{\textit{class SwitchableOutputStream}}
	\begin{itemize}
	 \item This class was added as OutputStream that allows the switching of the underlying stream.
	\end{itemize}
	
	\item \textbf{\textit{class SwitchableInputStream}}
	\begin{itemize}
	 \item This class was added as IntputStream that allows the switching of the underlying stream.
	\end{itemize}
	
	\item \textit{\textbf{class ServerMultiMessageOutChannel}}
	\begin{itemize}
	 \item The class \textit{"SocketMulticastServer"} was replaced by this class \textit{"ServerMultiMessageOutChannel"}.
	 \item \textit{"+SocketMulticastServer(socket : ServerSocket)"} was replaced by 
	 \textit{"+ServerMultiMessageOutChannel(server : ServerSocket , excHandler : Callback<Throwable>)"}.
	 \item \textit{"+send(data : byte[]) : void"} was deleted.
	\end{itemize}
	
   \item \textbf{\textit{class MultiOutputStream}}
  \begin{itemize}
	 \item The class \textit{"MultiOutChannel"} was replaced by this class \textit{"MultiOutputStream"}.
	 \item \textit{"+addChannel(channel : OutChannel) : void"} was replaced by 
	 \textit{"+addChannel(channel : OutputStream ) : void"}.
	 \item \textit{"+removeChannel(channel : OutChannel) : void"} was replaced by 
	 \textit{"+removeChannel(channel : OutputStream ) : void"}.
	 \item \textit{"+send(data : byte[]) : void"} was deleted.
	 \item The static interface \textit{"ErrorHandler"} was added to represent an error handler.
	 \item \textit{"+getChannels() : ImmutableList<OutputStream>"} was added to return an immutable 
	 list of all output channels.
	\end{itemize}
 
   \item \textbf{\textit{class StreamMessageInChannel}}
	\begin{itemize}
	 \item The class \textit{"MessageInChannel"} was replaced by this class \textit{"StreamMessageInChannel"}.
	\end{itemize}
	
   \item \textbf{\textit{class StreamMessageOutChannel}}
	\begin{itemize}
	 \item The class \textit{"MessageOutChannel""} was replaced by this class \textit{"StreamMessageOutChannel"}.
	 \item \textit{"+MessageOutChannel(inner : OutChannel)"} was replaced by 
	 \textit{"+StreamMessageOutChannel(inner : OutputStream)"}.
	 \item \textit{"+sendMessage(data : byte[]) : void"} was replaced by 
	 \textit{"+sendMessage(data: byte[], offset: int , len: int) : void"}.
	\end{itemize}
	
   \item \textbf{\textit{interface MessageInChannel}}
	\begin{itemize}
	 \item The interface \textit{""InChannel"} was renamed to \textit{"MessageInChannel"}.
	 \item \textit{"+recv(size : int, buffer : byte[]) : void"} was replaced by \textit{"+recvMessage() : byte[]"}.
	\end{itemize}
	
	 \item \textbf{\textit{abstract class MessageOutChannel}}
	\begin{itemize}
	 \item The interface \textit{"OutChannel"} was replaced by this abstract class \textit{"MessageOutChannel"}.
	 \item \textit{"+send(data : byte[]) : void"} was renamed to \textit{"+sendMessage(data : byte[]) : void"}.
	 \item \textit{"+sendMessage(data: byte[] , offset: int , len: int) : void"} was added to send data.
	\end{itemize}
	
\end{itemize}

\subsection{Package cryptocast.server}

\begin{itemize}
  
\item \textbf{\textit{class Controller}} \newline
The class \textit{Controller} now implements the interface \textit{Observer} so registered observers can 
tell the controller when it has to save the data this controller is connected to.
The following methods were added :
	\begin{itemize}
	 \item \textit{"+start(databaseFile : File , listenAddr : SocketAddress , keyBroadcastIntervalSecs: int ,
		 serverFactory : NPServerFactory) : Controller"} for creating a instance of this class. This method now 
	 	implements the parts of functionality of the former method \textit{"+init()"}  and 
		the constructor. Therefore, the access modifier of the constructor has changed to private and the method  
		\textit{"+init()"} has been removed.
	 \item \textit{"+saveUserKeys(dir : File , users : Set<User<NPIdentity>>) : void"} for saving
		 the personal keys of the users into a key-file at the given directory.
	 \item \textit{"+saveDatabase() : void"} for saving the database into a specific file.
	 \item \textit{"+getModel() : NaorPinkasServerData"} to return the data according to Naor-Pinkas.
	 \item \textit{"+getDatabesFile() : File"} to get the file containing the database or where it should be saved in.
	\item \textit{"+getT() : int"} returns the amount of users who can be revoked in the current cryptography.
	\item \textit{"+getListenAddress() :SocketAddredd"} in order to get the address on which port the server listens.
	 \item \textit{"+reinitializeCrypto(t : int) : void"} to reinitialize the cryptography so that t users can be revoked.
	 \item \textit{"+streamAudio(File file) : void"} to stream a MPEG-3 audio file.
	 \item \textit{"+streamSampleText() : void"} to stream a sample text.
	 \item \textit{"+stream(in : InputStream) : void"} to stream the data from the input stream.
	 \item \textit{"+stream(in : InputStream , maxBytesPerSec : long ) : void"} to stream the data while limiting 
	 	the number of bytes which are read per second.
	\item \textit{"+update(o : Observable, arg : Object) : void)} to save the database when it has changed.
	\end{itemize}
The following methods were removed:
	\begin{itemize}
	\item \textit{"+init()"}. Reasons for this decicision are stated above in the added method \textit{"+start(...)"}.
	\item \textit{"+keyGen(amtRevocable : int, amtPrivateKeys : int, keyDir : File)"}
	\item \textit{"+addUser(name : String)"}, \textit{"+revokeUser(name : String)"}, \textit{"+authorizeUser(name : String)"}
		and \textit{"+showUsers()"} have been moved to the class \textit{ServerData}. Also some of them have been renamed.
	\item \textit{"+showStatistics()"} and \textit{"+showInfo()"} have been removed at all because they were not needed anymore.
	\end{itemize}
\item \textbf{\textit{class Shell<ID>}}\newline
The following method was added:
	\begin{itemize}
	\item \textit{"+Shell(in : BufferedReader, out: PrintStream, err : PrintStream, control: Controller)"}. The parameter \textit{control : Controller}
		has been added.
	\item \textit{"+parseInt(strr : String) : Optional<Integer>"} so that converting Strings to Integer is possible.
	\end{itemize}
	
	\item \textbf{\textit{class ServerData<ID>}}\newline
	The following methods were added :
  \begin{itemize}
 	 \item \textit{"+initAfterDeserialization()"} to initalize the data after it was read from a file.
	 \item \textit{"+revoke(users : Set<User<ID>>) : void"} so that we can revoke multiple users at the same time.
	 \item \textit{"+revoke(user : User<ID>) : void"} so that we can revoke only one user.
	 \item \textit{"+unrevoke(user : User<ID>) : void} so that we can authorize a user.
	 \item \textit{"+isRevoked(user : User<ID> ) : boolean"} to let us know if a user is revoked or not.
	 \item \textit{"+Serverdata(userManager : BroadcastSchemeUserManager<ID>, keyManager :  BroadcastSchemeKeyManager<ID>)"} 
		to provide all classes the Serverdata uses.
	 \item \textit{"+getUsers() : Set<User<ID>> "} to return all users in our collection.
	\end{itemize}

   \item \textbf{\textit{class LogbackUtils}}
	\begin{itemize}
	 \item This class was added to provied a logger. The logger is used to provide debug information and to provide information to the user.
	\end{itemize}
	
	 \item \textbf{\textit{class NaorPinkasServerData}}
	\begin{itemize}
	 \item This class \textit{"NaorPinkasServerData"} was added for representing the server data according to Naor-Pinkas.
	\end{itemize}
	
	 \item \textbf{\textit{class OptParse}}
	\begin{itemize}
	 \item This class \textit{"OptParse"} was added for providing a Command line option parser.
	\end{itemize}
	
   \item \textit{\textbf{class ShellCommand}}
	\begin{itemize}
	 \item The class \textit{"ShellCommand"} was added for representing the commands available in the shell.
	\end{itemize}
	
\end{itemize}


\subsection{Package cryptocast.server.programs}
This  completely new package contains some classes used for testing and setting up the server:
\begin{itemize}
	\item \textit{Benchmarks} gathers data about the time several functions needed by the cryptography are running
		with several paramters. The available benchmarks are  lagrange, encrypt, multi-encrypt, decrypt, multi-eval, keygen, multi-exp.
		TODO: translate bechmarks in proper language, add description below
	\item \textit{Client} starts a cterminal-based client. A keyfile must be provided to it to run.
	\item \textit{HttpStreamer} 
	\item \textit{TcpStreamer}
	\item \textit{Server}: Runs a server.
\end{itemize}


\subsection{Package cryptocast.client}


\begin{itemize}

\item \textbf{\textit{class StreamViewerActivity}} \newline
   This class now implements  \textit{MediaController.MediaPlayerContro}l to provide better 
	control of the media player. In addition, the following methods were added:
	\begin{itemize}
	 \item \textit{"+setStatusText(text : String)"} to set the player's status text.
	 \item \textit{"+createErrorPopup(message : String")} to create an error popup from other classes.
	\end{itemize}
	
	 \item \textbf{\textit{class MainActivity}}
	\begin{itemize}
	 \item \textit{"+connectToServer(View view) : void"} was renamed to \textit{+onConnect(View view) : void"}.
	 \item \textit{"+onOldServers(View view) : void"} was added to start a new server fragment for showing the 
	  list of all servers.
		\item \textit{"+getConnectAddr() : Optional<InetSocketAddress>"} was added to get the socket address 
		and to check, if the host name and the port number are valid.
	\end{itemize}
	
	\item \textbf{\textit{class ServerHistory}} \newline
	The following methods were added :
	\begin{itemize}
   \item \textit{"+deleteServer(InetSocketAddress addr) : void"} to delete a server from the server history.
	 \item \textit{"+invalidateKeyFile(InetSocketAddress addr) : void"} to delete a saved key file of the server.
	 \item \textit{"+getKeyFile(InetSocketAddress addr) : Optional<File>"} to return the key file of the given server.
	\end{itemize}

 \item \textit{\textbf{class ClientActivity}}
	\begin{itemize}
	 \item This class was added as base activity, which provides basic common functionality.
	\end{itemize}
	 
    \item \textbf{\textit{class ClientApplication}}
	\begin{itemize}
	 \item This class was added for maintaining the global application state.
	\end{itemize}
	
	\item \textbf{\textit{class HelpActivity}}
	\begin{itemize}
	 \item This class was added to represent an activity that displays the help page.
	\end{itemize}
	
	\item \textbf{\textit{class AboutActivity}}
	\begin{itemize}
	 \item This class was added to represent the about dialog.
	\end{itemize}
	
   \item \textbf{\textit{class MessageFragment}}
  \begin{itemize}
	 \item The class \textit{"ErrorFragment"} was renamed to \textit{"MessageFragment"}.
	\end{itemize}
	
	\item \textbf{\textit{class ServersFragment}}
	\begin{itemize}
	 \item This class was added to represent a list of all saved servers.
	\end{itemize}
	
	\item \textbf{\textit{class ServerListAdapter}}
	\begin{itemize}
	\item This class was added to provide an adapter between the ListElements and the view showing them.
	\end{itemize}
	
	\item \textbf{\textit{class RawStreamMediaPlayer}}
	\begin{itemize}
  \item This class was added to provide Media player to play audio from a raw InputStream.
	\end{itemize}
	
    \item \textbf{\textit{class StreamConnector}} 
	\begin{itemize}
	 \item This class was added to separate work from the StreamViewerActivity class 
	in a separate thread to prevent the GUI not from showing properly.
	\end{itemize}
	
\end{itemize}

	
\subsection{Package cryptocast.client.filechooser}

\begin{itemize}

 \item \textit{\textbf{class NavigateUpListElement}}
	\begin{itemize}
	 \item This class was added as a list element in our file chooser representing a directory.
	\end{itemize}
	 
    \item \textbf{\textit{class FileChooserState}}
	\begin{itemize}
	 \item This class was added to represent the state of a file chooser.
	\end{itemize}
	
\end{itemize}
	
\subsection{Package cryptocast.util}

\begin{itemize}
  
   \item \textbf{\textit{class ByteUtils}}
	\begin{itemize}
	 \item This class was added to provide several bytes and byte arrays utility functions.
	\end{itemize}
	
	 \item \textbf{\textit{class ErrorUtils}}
	\begin{itemize}
	 \item This class was added to provide several error handling utility methods.
	\end{itemize}
	
	 \item \textbf{\textit{class MapUtils}}
	\begin{itemize}
	 \item This class was added to provide map utility methods.
	\end{itemize}
	
   \item \textit{\textbf{class NativeUtils}}
	\begin{itemize}
	 \item This class was added to provide several utility methods for easier native code calls.
	\end{itemize}
	
	\item \textit{\textbf{class SerializationUtils}}
	\begin{itemize}
	 \item This class was added to provide several serialization utility methods.
	\end{itemize}
	
	\item \textit{\textbf{class FileUtils}}
	\begin{itemize}
	 \item This class was added to provide file/io utility methods.
	\end{itemize}
	
	\item \textit{\textbf{class Generator<T>}}
	\begin{itemize}
	 \item This class was added to represent a range generator.
	\end{itemize}
	
	\item \textit{\textbf{class OptimisticGenerator<T>}}
	\begin{itemize}
	 \item This class was added to represent a optimistic generator.
	\end{itemize}
	
	\item \textit{\textbf{interface CanBeObserved}}
	\begin{itemize}
	 \item This interface was added to represent an observable object.
	\end{itemize}
	
	\end{itemize}
	
	
\subsection{Package cryptocast.crypto}

\begin{itemize}
	
	
	 \item \textbf{\textit{CyclicGroupOfPrimeOrder<T>}}
	\begin{itemize}
	 \item This class was added to represent a cyclic group $(G, \otimes)$ of prime order $q$ over a subset 
    $G$ of the values of type T, generated by $g$.
	\end{itemize}
	
   \item \textit{\textbf{class DecryptionError}}
	\begin{itemize}
	 \item This class was added to throw an exception when an error occurs while decpryting a stream.
	\end{itemize}
	
	\item \textit{\textbf{class DynamicCipherInputStream}}
	\begin{itemize}
	 \item This class was added to represent a dynamic cipher input stream, which is an input stream that
	  needs to be decrypted. This stream uses a message-based communication channel.
	\end{itemize}
	
	\item \textit{\textbf{class DynamicCipherKeyUpdateMessage}}
	\begin{itemize}
	 \item This class was added to represent a message for dynamic updates of the cipher key.
	\end{itemize}
	
	\item \textit{\textbf{class DynamicCipherOutputStream}}
	\begin{itemize}
	 \item This class was added to represent a dynamic cipher output stream, which is an output stream 
	 that is decrypted upon writing. This stream uses a message-based communication channel.
	\end{itemize}
	
	\item \textit{\textbf{interface EllipticCurve<T, P>}}
	\begin{itemize}
	 \item TODO.
	\end{itemize}
	
	\item \textit{\textbf{class EllipticCurveGroup<T, P, C extends EllipticCurve<T, P> >}}
	\begin{itemize}
	 \item TODO.
	\end{itemize}
	
	\item \textit{\textbf{class EllipticCurveOverFp}}
	\begin{itemize}
	 \item TODO.
	\end{itemize}
	
	\item \textit{\textbf{class InsufficientInformationError}}
	\begin{itemize}
	 \item This class was added to throw an exception when insufficient information is provided for the Naor-Pinkas Client.
	\end{itemize}
	
	\item \textit{\textbf{class NoMoreRevocationsPossibleError}}
	\begin{itemize}
	 \item This class was added to throw an exception when no more revocations are possible.
	\end{itemize}
	
	\item \textit{\textbf{class PolynomialMultiEvaluation}}
	\begin{itemize}
	 \item This class was added to evaluate a polynomial at multiple points. A native function is used, 
	 if n is bigger than a specific threshold.
	\end{itemize}
	
	\item \textit{\textbf{class SchnorrGroup}}
	\begin{itemize}
	 \item This class was added to represent a schnorr group.
	\end{itemize}
	
	\item \textbf{\textit{class CryptoUtils}}
	\begin{itemize}
	 \item TODO.
	\end{itemize}
		
\end{itemize}

\subsection{Package cryptocast.crypto.naorpinkas}

\begin{itemize}
	
	
	\item \textit{\textbf{class ECNPClient}}
	\begin{itemize}
	 \item TODO.
	\end{itemize}
	
	\item \textit{\textbf{class ECNPServer}}
	\begin{itemize}
	 \item TODO.
	\end{itemize}
	
	\item \textit{\textbf{class ECNPServerFactory}}
	\begin{itemize}
	 \item TODO.
	\end{itemize}
	
	\item \textit{\textbf{class NPClient<T, G extends CyclicGroupOfPrimeOrder<T> > }}
	\begin{itemize}
	 \item The class \textit{\textbf{NaorPinkasClient}} was replaced by this class.
	\end{itemize}
	
	\item \textit{\textbf{class NPIdentity}}
	\begin{itemize}
	 \item The class \textit{\textbf{NaorPinkasIdentity}} was replaced by this class.
	\end{itemize}
	
	\item \textit{\textbf{class NPKey<T, G extends CyclicGroupOfPrimeOrder<T> >}}
	\begin{itemize}
	 \item The class \textit{\textbf{NaorPinkasPersonalKey}} was replaced by this class.
	\end{itemize}
	
	\item \textit{\textbf{class NPKeyGenerator<T, G extends CyclicGroupOfPrimeOrder<T> >}}
	\begin{itemize}
	 \item This class was added for generating naor-pinkas keys.
	\end{itemize}
	
	\item \textbf{\textit{class SchnorrNPServerFactory}}
	\begin{itemize}
	 \item TODO.
	\end{itemize}
	
	\item \textit{\textbf{class NPMessage<T, G extends CyclicGroupOfPrimeOrder<T> >}}
	\begin{itemize}
	 \item This class was added to represent a naor-pinkas message sent from the server to the clients.
	\end{itemize}
	
	\item \textit{\textbf{class NPServer<T, G extends CyclicGroupOfPrimeOrder<T> >}}
	\begin{itemize}
	 \item The class \textit{\textbf{NaorPinkasServer}} was replaced by this class.
	\end{itemize}
	
	\item \textit{\textbf{class NPServerContext<T, G extends CyclicGroupOfPrimeOrder<T> >}}
	\begin{itemize}
	 \item TODO.
	\end{itemize}
	
	\item \textit{\textbf{class interface NPServerFactory}}
	\begin{itemize}
	 \item TODO.
	\end{itemize}
	
	\item \textit{\textbf{interface NPServerInterface}}
	\begin{itemize}
	 \item TODO.
	\end{itemize}
	
	\item \textit{\textbf{class NPShare<T, G extends CyclicGroupOfPrimeOrder<T> >}}
	\begin{itemize}
	 \item The class \textit{\textbf{NaorPinkasShare}} was replaced by this class.
	\end{itemize}
	
	\item \textit{\textbf{class NPShareCombinator<T, G extends CyclicGroupOfPrimeOrder<T> >}}
	\begin{itemize}
	 \item The class \textit{\textbf{NaorPinkasShareCombinator}} was replaced by this class.
	\end{itemize}
	
	\item \textit{\textbf{class SchnorrNPClient}}
	\begin{itemize}
	 \item TODO.
	\end{itemize}
	
	\item \textit{\textbf{class SchnorrNPServer}}
	\begin{itemize}
	 \item TODO.
	\end{itemize}
		
\end{itemize}
	



\end{document}

